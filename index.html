<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <!-- Add viewport-fit to respect notches/safe areas -->
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Qualis Artifex — Library (V18)</title>

  <style>
    /* Mobile-safe root layout */
    html, body {
      margin: 0;
      padding: env(safe-area-inset-top) env(safe-area-inset-right)
               env(safe-area-inset-bottom) env(safe-area-inset-left);
      height: auto;
      min-height: 100dvh;      /* dynamic viewport height to avoid cropping */
      overflow: auto;          /* allow scroll if needed */
      background: #0f0e0d;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, sans-serif;
    }

    /* Stage holds dust + SVG */
    .stage{
      width: 100%;
      max-height: 100dvh;
      aspect-ratio: 1228 / 819;  /* image’s native ratio */
      position: relative;         /* create a stacking context for children */
      margin: 0 auto;
      background: #151311;        /* fallback around the art */
      isolation: isolate;
    }

    /* Dust layer behind the SVG */
    canvas#dust{
      position: absolute;
      inset: 0;
      z-index: 1;
      mix-blend-mode: screen;
      pointer-events: none;
    }

    /* SVG should sit above dust and fill the stage */
    .stage > svg{
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      display: block;
      z-index: 2;
      background: #151311;
    }

    /* Click/touch areas */
    .hit { fill: transparent; cursor: pointer; }
    .hit:hover { fill: rgba(255,224,160,0.06); }
  </style>
</head>

<body>
  <div class="stage">
    <!-- Dust canvas (now actually present) -->
    <canvas id="dust"></canvas>

    <!-- Background image + hotspots use image-space coords -->
    <svg viewBox="0 0 1228 819" preserveAspectRatio="xMidYMid meet">
      <image href="./front-page.jpg" x="0" y="0" width="1228" height="819" />

      <!-- Clickable plaques -->
      <a xlink:href="ap-reading.html">
        <rect class="hit" x="178" y="235" width="117" height="110" />
      </a>
      <a xlink:href="cornology.html">
        <rect class="hit" x="324" y="222" width="123" height="112" />
      </a>
      <a xlink:href="practice.html">
        <rect class="hit" x="757" y="242" width="248" height="103" />
      </a>

      <a xlink:href="#" onclick="return false">
        <rect class="hit" x="242" y="573" width="118" height="75" />
      </a>
      <a xlink:href="lower2.html">
        <rect class="hit" x="395" y="571" width="121" height="79" />
      </a>
      <a xlink:href="https://qualisartifex1.github.io/LatinNotes/" target="_blank" rel="noopener">
        <rect class="hit" x="543" y="567" width="123" height="83" />
      </a>
      <a xlink:href="quiz-bowl.html">
        <rect class="hit" x="697" y="567" width="122" height="79" />
      </a>
      <a xlink:href="https://qualisartifex1.github.io/FlashCardsAllSubjects/" target="_blank" rel="noopener">
        <rect class="hit" x="849" y="570" width="123" height="78" />
      </a>
    </svg>
  </div>

  <!-- Dust script (unchanged from your file, but now has a canvas to target) -->
  <script>
  (function dust(){
    const canvas = document.getElementById('dust');
    if (!canvas) return; // safety
    const ctx = canvas.getContext('2d');
    const reduceMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
    const shimmerOrigin = { x: 0.06, y: 0.09 };

    let w, h, dpr, motes = [];
    const LAYERS = [
      { z:0.25, count:36, size:[0.6,1.2], speed:[0.02,0.06], opacity:[0.18,0.38], blur:1.2 },
      { z:0.55, count:64, size:[0.9,1.8], speed:[0.04,0.10], opacity:[0.20,0.42], blur:1.6 },
      { z:1.00, count:52, size:[1.2,2.4], speed:[0.06,0.14], opacity:[0.25,0.48], blur:2.4 },
    ];

    let mx=0.5,my=0.45, tx=0.5,ty=0.45;
    const lerp=(a,b,t)=>a+(b-a)*t, clamp=(v,a,b)=>Math.max(a,Math.min(b,v));
    function size(){ dpr=Math.min(window.devicePixelRatio||1,2); w=innerWidth; h=innerHeight;
      canvas.width=Math.floor(w*dpr); canvas.height=Math.floor(h*dpr); ctx.setTransform(dpr,0,0,dpr,0,0); }
    size(); addEventListener('resize', size);
    function rand(a,b){ return a+Math.random()*(b-a); }
    function makeMote(L){ const c=Math.random()>0.6?'#fff7d6':'#f4e2b5'; return {
      x:Math.random()*w, y:Math.random()*h, r:rand(L.size[0],L.size[1]),
      a:Math.random()*Math.PI*2, s:rand(L.speed[0],L.speed[1])*(reduceMotion?0.3:1),
      o:rand(L.opacity[0],L.opacity[1]), z:L.z, c, tw:Math.random()*200+80, t:Math.random()*Math.PI*2 }; }
    function reset(p,fromTop=false){ p.x=Math.random()*w; p.y=fromTop?-10:Math.random()*h; }
    function init(){ motes=[]; LAYERS.forEach(L=>{ for(let i=0;i<L.count;i++) motes.push(makeMote(L)); }); } init();
    addEventListener('mousemove',e=>{ tx=e.clientX/w; ty=e.clientY/h; },{passive:true});
    const WIND={t:0, px:34, py:46, sx:0.22, sy:0.16};
    function windowShimmer(x,y,t){ const lx=shimmerOrigin.x*w, ly=shimmerOrigin.y*h;
      const dx=(x-lx)/w, dy=(y-ly)/h, d=Math.hypot(dx,dy); const influence=clamp(1-d*2.2,0,1);
      if(influence<=0) return 0; const s=0.08*Math.sin(t/700 + x*0.004 + y*0.003); return s*influence; }
    let last=performance.now();
    function tick(now){ const dt=Math.min(60, now-last); last=now; mx=lerp(mx,tx,0.03); my=lerp(my,ty,0.03);
      ctx.clearRect(0,0,w,h); ctx.globalCompositeOperation='source-over'; ctx.globalAlpha=0.07; ctx.fillStyle='#0c0a07'; ctx.fillRect(0,0,w,h);
      WIND.t+=dt/1000; const windX=reduceMotion?0:WIND.sx*Math.sin(2*Math.PI*WIND.t/WIND.px);
      const windY=reduceMotion?0:WIND.sy*Math.cos(2*Math.PI*WIND.t/WIND.py);
      for(const L of LAYERS){ const shiftX=(mx-0.5)*(1.2-L.z)*12, shiftY=(my-0.5)*(1.2-L.z)*10;
        ctx.shadowBlur=L.blur; ctx.shadowColor='rgba(255,240,210,0.95)';
        for(const p of motes){ if(p.z!==L.z) continue;
          p.a+=(Math.random()-0.5)*0.02;
          p.x+=Math.cos(p.a)*p.s*(0.8+p.z*0.6)+windX*(0.5+p.z*0.8);
          p.y+=Math.sin(p.a)*p.s*0.4+0.015*(1+p.z*1.5)+windY*(0.3+p.z*0.6);
          if(p.x<-20||p.x>w+20||p.y>h+20) reset(p,true);
          p.t+=(2*Math.PI)/p.tw*(dt/1000);
          const tw=0.85+0.15*Math.sin(p.t), sh=windowShimmer(p.x,p.y,now);
          const alpha=clamp(p.o*tw+sh,0,0.85); ctx.globalAlpha=alpha; ctx.fillStyle=p.c;
          ctx.beginPath(); ctx.arc(p.x+shiftX,p.y+shiftY,p.r,0,Math.PI*2); ctx.fill(); }
      }
      ctx.shadowBlur=0; requestAnimationFrame(tick); }
    requestAnimationFrame(tick);
  })();
  </script>
</body>
</html>
